## 并查集
```c++
class Union
{
   private:
    vector<int> fa;

   public:
    Union() = default;
    explicit Union(int n) { fa.resize(n, -1); }
    int find(int x) { return fa[x] < 0 ? x : (fa[x] = find(fa[x])); }
    bool unite(int x, int y)
    {
        x = find(x), y = find(y);
        if (x == y) return false;
        if (fa[x] > fa[y]) swap(x, y);
        fa[x] += fa[y];
        fa[y] = x;
        return true;
    }
    bool same(int x, int y) { return find(x) == find(y); }
    int getSetCount() const
    {
        int cnt = 0;
        for (auto& x : fa)
            cnt += x < 0;
        return cnt;
    }
};
```

可撤销并查集

```c++
class DSU
{
   private:
    std::vector<int> fa, siz;
    std::vector<std::array<int, 2>> his;

   public:
    DSU() = default;
    explicit DSU(int n) { init(n); }

    void init(int n)
    {
        fa.resize(n);
        std::iota(fa.begin(), fa.end(), 0);
        siz.assign(n, 1);
        his.clear();
    }

    int find(int x)
    {
        while (x != fa[x])
        {
            x = fa[x];
        }
        return x;
    }

    bool same(int x, int y) { return find(x) == find(y); }

    bool merge(int x, int y)
    {
        x = find(x), y = find(y);
        if (x == y) return false;
        if (siz[x] < siz[y]) std::swap(x, y);
        his.push_back({x, y});
        fa[y] = x;
        siz[x] += siz[y];
        return true;
    }

    int time() { return (int)his.size(); }

    void revert(int tm)
    {
        while (his.size() > tm)
        {
            auto [x, y] = his.back();
            his.pop_back();
            fa[y] = y, siz[x] -= siz[y];
        }
    }

    int size(int x) { return siz[find(x)]; }

    [[nodiscard]] int getSetCount() const
    {
        int count = 0;
        for (int i = 0; i < fa.size(); ++i)
        {
            if (fa[i] == i)
            {
                count++;
            }
        }
        return count;
    }
};
```



