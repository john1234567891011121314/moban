## 概率期望
### 两两分组

$n$个数，两两分组的方案数为 $\frac{n !}{(\frac{n}{2})! \times 2^{\frac{n}{2}}}$

即先全排列，将1和2，3和4归为一组，然后考虑将重复方案去掉，因为1和2与2和1这两种分法相同，因此去掉调换位置的答案$2^{\frac{n}{2}}$，然后求的是组合，因此将每一组的顺序也去掉$(\frac{n}{2})!$​

### 差的绝对值的期望

随机变量$X，Y$分别是$[l_1,r_1],[l_2,r_2]$上均匀分布的整数

求$E(|X-Y|)$

```c++
int Ex(int a, int b, int c, int d)
{
    if (a > c)
    {
        swap(a, c);
        swap(b, d);
    }
    if (c >= b)
    {
        return ((c + d) - (a + b)) / 2;
    }
    if (b > d)
    {
        mint e_ad_cd = Ex(a, d, c, d);
        mint p_ad_cd = (d - a + 1) / (b - a + 1);
        mint e_db_cd = (b - c + 1) / 2;
        mint p_db_cd = (b - d) / (b - a + 1);
        mint Ans = e_ad_cd * p_ad_cd  + e_db_cd * p_db_cd;
        return Ans;
    }
    mint n = max(b - c + 1, 0ll);
    mint e_ab_cd =
        ((c + d) - (a + b)) / 2;
    mint e_cb_cb = (n - 1 / n) / 3;
    mint p_cb_cb = n / (b - a + 1) * n * (d - c + 1);
    mint p_ab_cd = 1 - p_cb_cb;
    return e_ab_cd + e_cb_cb * p_cb_cb;
}
```

如果是连续分布那么

```c++
double eabs(double a, double b, double c, double d)
{
    if (a > c) {swap(a, c); swap(b, d);}
    if (b > d)
    {
        double e_ad_cd = eabs(a, d, c, d);
        double p_ad_cd = (d - a) / (b - a);
        double e_db_cd = (b - c) / 2.0;
        double p_db_cd = (b - d) / (b - a);
        return e_ad_cd * p_ad_cd + e_db_cd * p_db_cd;
    }
    double n = max(b - c, 0.0);
    double e_ab_cd = (c + d - a - b) / 2.0;
    double e_cb_cb = n / 3.0;
    double p_cb_cb = n / (b - a) * n / (d - c);
    return e_ab_cd + e_cb_cb * p_cb_cb;
}
```



### 鞅

鞅的引入是为了解决一类期望进行轮数的问题。

$A=\{A_0,A_1,A_2,\cdots,A_n\}$为随机过程，设$T$为停时（停止时刻）。

那么我们可以尝试构造这样一个势函数，他满足

1. $E(\Phi(A_{n+1}) - \Phi(A_{n}) |A_{0}, \cdots,A_n ) = -1$
2. $\Phi(A_T)$为常数，且$\Phi(A_i)=\Phi(A_T)$当且仅当$i=T$

那么进一步我们可以尝试$X_n=\Phi(A_n)+n$，那么显然$\{ X\}$是一个鞅，那么相应就有$E(X_T)=E(X_0)$，即$E(\Phi(A_T)) + E(T) = E(\Phi(A_0))$，那么我们就有
$$
E(T)=E(\Phi(A_T)) - \Phi(A_0)
$$
通常构造势函数的过程比较板。

#### CF1025G Company Acquisitions

##### 题意

#### CF1349D Slime and Biscuits

##### 题意

有$n$个人，第$i$个人拥有$a_i$块饼干，每次操作随机选择一块饼干，假设其属于$x$，然后再随机选择一个人$y$，求只有一个人拥有饼干的期望轮数。

##### 分析

套路的，我们设每个人的势函数$f(a)$，那么一开始的状态$A_0$对应的势函数$\Phi(A_0)$为$\sum f(a_{i,0})$，然后根据题意我们有$\Phi(A_{T+1})=\sum_{i=1}^n \sum_{j!=i}\frac{1}{h_t*(n-1)}f(a_i-1)+f(a_{j+1})+\sum_{k!=i,k!=j}f(a_k) $，然后想办法转换求出$f$

